(()=>{"use strict";function t(t){chrome.tabs.query({active:!0,currentWindow:!0},t)}async function e(){t((([{id:t}])=>{chrome.tabs.sendMessage(t,{action:"ping"},(e=>{(chrome.runtime.lastError||"pong"!==e?.message)&&async function(t){await chrome.scripting.insertCSS({files:["content.styles.css"],target:{tabId:t}}),await chrome.scripting.executeScript({files:["contentScript.bundle.js"],target:{tabId:t}})}(t)}))}))}async function a(){t((([{id:t}])=>{chrome.tabs.sendMessage(t,{action:"popout-to-tab"},(t=>{}))}))}const n="https://www.google-analytics.com/mp/collect",o="3p2Wsi7fTfulKRPG-65uEQ",s="G-06FQ8PT93C";async function i(){let{sessionData:t}=await chrome.storage.session.get("sessionData");const e=Date.now();if(t&&t.timestamp){(e-t.timestamp)/6e4>30?t=null:(t.timestamp=e,await chrome.storage.session.set({sessionData:t}))}return t||(t={session_id:e.toString(),timestamp:e.toString()},await chrome.storage.session.set({sessionData:t})),t.session_id}async function c(){let t=(await chrome.storage.local.get("clientId")).clientId;return t||(t=self.crypto.randomUUID(),await chrome.storage.local.set({clientId:t})),t}chrome.runtime.onInstalled.addListener((function(){const t="Open "+chrome.runtime.getManifest().name;chrome.contextMenus.create({title:t,contexts:["page","selection"],id:"sdsdcsdxx"})})),chrome.contextMenus.onClicked.addListener((function(t){e(),setTimeout(a,300)}));function r(e){t((([{id:t}])=>{chrome.tabs.sendMessage(t,{action:"is-ext-visible-in-page"},(t=>{e(t)}))}))}chrome.runtime.setUninstallURL("https://forms.office.com/Pages/ResponsePage.aspx?id=DQSIkWdsW0yxEjajBLZtrQAAAAAAAAAAAANAARjRBjlUOEVZNkRIOVBRMDY0Nkc5MzFIRVlGSFk2My4u",(()=>{chrome.runtime.lastError&&chrome.runtime.lastError})),chrome.runtime.onMessage.addListener((function(m={},d,l){if("load-contentScript"!==m.action)if("store-am-data"===m.action){if(m.data)return function(t,e,a){chrome.storage.local.set({[t]:e},(()=>{a(e)}))}(m.collectionId,m.data,l),!0}else{if("get-am-data"===m.action)return function(t,e){chrome.storage.local.get(t,(a=>{e({data:a[t]||[]})}))}(m.collectionId,l),!0;if("run-automation"===m.action)return function({collectionId:e,automationId:a,context:n},o){t((([{id:t}])=>{chrome.storage.local.get(e,(s=>{let i=s[e]||[];i=a?[i.find((t=>t.id===a))]:i.filter((t=>!t.disabled));const c=i.reduce(((t,e)=>[...t,...e.actions]),[]);chrome.tabs.sendMessage(t,{action:"start-automation-task",tasks:c,context:n}),o("started")}))}))}(m,l),!0;if("popout-to-tab"===m.action)return a(),!0;if("toggle-element-picker"===m.action)return function({automationId:e,actionId:a,enable:n},o){t((([{id:t}])=>(chrome.tabs.sendMessage(t,{action:"toggle-element-picker",automationId:e,actionId:a,enable:n},(()=>{o(!chrome.runtime.lastError)})),!0)))}(m,l),!0;if("ext-visible-inpage"===m.action)return r(l),!0;"forward-to-fe"===m.action?r((e=>{e?t((([{id:t}])=>{chrome.tabs.sendMessage(t,m.data)})):chrome.runtime.sendMessage(m.data)})):"forward-to-cs"===m.action?t((([{id:t}])=>{chrome.tabs.sendMessage(t,m.data)})):"report-action"===m.action&&async function(t={},e={}){let{eventName:a}=t;const{label:r}=e;r&&(a+=`_${r}`),fetch(`${n}?measurement_id=${s}&api_secret=${o}`,{method:"POST",body:JSON.stringify({client_id:await c(),events:[{name:a,params:{...e,session_id:await i(),engagement_time_msec:100}}]})})}(m.event,m.data)}else e()}))})();