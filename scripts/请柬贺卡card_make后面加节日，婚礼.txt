# -*- coding: utf-8 -*-
import sys
import os
import random
import time  # æ–°å¢æ­¤è¡Œ
from PIL import Image, ImageDraw, ImageFont
from pathlib import Path

def create_card(card_type='å©šç¤¼'):
    try:
        print(f"ğŸ¨ æ­£åœ¨è®¾è®¡{card_type}è¯·æŸ¬...")
        
        # ä¸­æ–‡å­—ä½“è§£å†³æ–¹æ¡ˆï¼ˆå¢åŠ å¤‡é€‰å­—ä½“ï¼‰
        font_list = [
            "C:/Windows/Fonts/simhei.ttf",    # é»‘ä½“
            "C:/Windows/Fonts/msyh.ttc",      # å¾®è½¯é›…é»‘
            "C:/Windows/Fonts/simfang.ttf"    # ä»¿å®‹
        ]
        font_path = next((f for f in font_list if os.path.exists(f)), None)
        
        if not font_path:
            raise FileNotFoundError("æœªæ‰¾åˆ°ç³»ç»Ÿå­—ä½“æ–‡ä»¶")
        
        # åˆ›å»ºå­˜å‚¨ç›®å½•
        save_path = Path(f"D:/AI_System/data/raw/ç”µå­æ¨¡æ¿ç´ æ/{card_type}è¯·æŸ¬")
        save_path.mkdir(parents=True, exist_ok=True)
        
        # ç”Ÿæˆç”»å¸ƒï¼ˆä¿®æ­£é¢œè‰²ç”Ÿæˆé€»è¾‘ï¼‰
        bg_color = (
            random.randint(200, 255),
            random.randint(200, 255),
            random.randint(200, 255)
        )
        img = Image.new('RGB', (1200, 800), color=bg_color)
        draw = ImageDraw.Draw(img)
        
        # æ·»åŠ æ–‡å­—å†…å®¹ï¼ˆå¢åŠ å¼‚å¸¸å¤„ç†ï¼‰
        text_map = {
            'å©šç¤¼': "è¯šé‚€æ‚¨å‚åŠ \nå¼ å…ˆç”Ÿ & æå¥³å£«\nå©šç¤¼ç››å…¸\næ—¶é—´ï¼š2025å¹´6æœˆ6æ—¥\nåœ°ç‚¹ï¼šå¹¸ç¦å¤§é…’åº—",
            'èŠ‚æ—¥': "æ­è´ºæ–°ç¦§\n2025æ–°æ˜¥å¿«ä¹\nå¿ƒæƒ³äº‹æˆ ä¸‡äº‹å¦‚æ„"
        }
        try:
            font = ImageFont.truetype(font_path, 36)
        except IOError:
            font = ImageFont.load_default()
        
        draw.multiline_text(
            (600, 300), 
            text_map.get(card_type, ""), 
            fill=(0, 0, 0), 
            font=font, 
            align='center', 
            anchor='mm'
        )
        
        # ä¿å­˜æ–‡ä»¶ï¼ˆä¿®æ­£æ—¶é—´æˆ³ï¼‰
        timestamp = int(time.time())
        filename = f"{card_type}è¯·æŸ¬_{timestamp}.png"
        img.save(save_path / filename)
        print(f"âœ… æ–‡ä»¶å·²ä¿å­˜ï¼š{save_path / filename}")
        
    except Exception as e:
        print(f"âŒ å‘ç”Ÿé”™è¯¯ï¼š{str(e)}")
        input("æŒ‰å›è½¦é”®é€€å‡º...")

if __name__ == "__main__":
    if len(sys.argv) > 1:
        create_card(sys.argv[1])
    else:
        print("è¯·åœ¨å‘½ä»¤åæ·»åŠ ç±»å‹ï¼ˆå©šç¤¼/èŠ‚æ—¥ï¼‰")
        input("æŒ‰å›è½¦é”®é€€å‡º...")